(function(){"use strict";var e={6328:function(e,a,n){var t=n(9242),s=n(3396);function o(e,a){const n=(0,s.up)("router-view");return(0,s.wg)(),(0,s.j4)(n)}var l=n(89);const i={},r=(0,l.Z)(i,[["render",o]]);var u=r,c=n(2483),d=(n(560),n(4870));const v={class:"main-nav"};function p(e,a){const n=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("div",v,[(0,s.Wm)(n,{class:"main-nav",to:{name:"audio"}},{default:(0,s.w5)((()=>[(0,s.Uk)("Audio Mode")])),_:1}),(0,s.Wm)(n,{class:"main-nav",to:{name:"messages"}},{default:(0,s.w5)((()=>[(0,s.Uk)("Message Mode")])),_:1})])}const g={},f=(0,l.Z)(g,[["render",p],["__scopeId","data-v-2179baea"]]);var m=f;const y=e=>((0,s.dD)("data-v-2f3e5de7"),e=e(),(0,s.Cn)(),e),w={class:"home"},h=y((()=>(0,s._)("div",{class:"main-container"},[(0,s._)("h1",null,"Personal Agent")],-1)));var _=(0,s.aZ)({__name:"HomeView",setup(e){(0,d.iH)([{type:"user",message:{id:1,content:"my content"}},{type:"assistant",message:{id:1,content:"assistant content"}}]);return(e,a)=>((0,s.wg)(),(0,s.iD)("div",w,[(0,s.Wm)(m),h]))}});const k=(0,l.Z)(_,[["__scopeId","data-v-2f3e5de7"]]);var x=k,b=(n(8858),n(1318),n(3228),n(7139)),A=n(8583),H=n(1076);function D(e){return new Promise((a=>setTimeout(a,e)))}function M(){let e=(new Date).getTime(),a="undefined"!==typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){let t=16*Math.random();return e>0?(t=(e+t)%16|0,e=Math.floor(e/16)):(t=(a+t)%16|0,a=Math.floor(a/16)),("x"===n?t:3&t|8).toString(16)}))}function C(e){console.log("scrollToBottom"),console.log(e),console.log(e?.scrollTop,e?.scrollHeight),e&&(e.scrollTop=e.scrollHeight)}const O={class:"audio"},T={key:0,class:"audio-recording-container"},U=(0,s._)("h1",{class:"title"},"Audio Recording",-1),L={key:0,ref:"recordingControlButtonsContainer",class:"recording-control-buttons-container"},q={ref:"elapsedTimeTag",class:"recording-elapsed-time"},F={key:0,class:"red-recording-dot fa fa-circle"},Z={class:"elapsed-time"},S={key:1},V=(0,s._)("i",{class:"fa fa-spinner fa-pulse fa-3x fa-fw"},null,-1),j=(0,s._)("span",{class:"sr-only"},"Loading...",-1),W=[V,j],X={ref:"textIndicatorOfAudiPlaying",class:"text-indication-of-audio-playing-container"},J={key:0,class:"text-indication-of-audio-playing"},I=(0,s._)("span",null,".",-1),P=(0,s._)("span",null,".",-1),R=(0,s._)("span",null,".",-1),Y={key:1,ref:"overlay",class:"overlay"},z=(0,s._)("div",{class:"browser-not-supporting-audio-recording-box"},[(0,s._)("p",null,"To record audio, use browsers like Chrome and Firefox that support audio recording."),(0,s._)("button",{type:"button",class:"close-browser-not-supported-box"}," Ok. ")],-1),E=[z],B="https://agent.anacreation.com/";var K=(0,s.aZ)({__name:"AudioView",setup(e){const a=(0,d.iH)(!1),n=(0,d.iH)(!1),t=(0,d.iH)(!1),o=(0,d.iH)(!1),l=(0,d.iH)(!1),i=(0,d.iH)(!1),r=(0,d.iH)(0),u=(0,d.iH)(!1),c=(0,s.Fl)((()=>{let e=Math.floor(r.value/60),a=r.value%60;return e=e<10?"0"+e:e,a=a<10?"0"+a:a,e+":"+a})),v=(0,d.iH)(null),p=(0,s.Fl)((()=>v.value?B+`audio/${v.value}`:null)),g=(0,d.iH)(null),f=(0,d.iH)(0);let m,y,w,h=null;const _=()=>{o.value=!1,a.value=!1},k=()=>{w=null,_()},x=async()=>{h&&await h.reset();try{m=await navigator.mediaDevices.getUserMedia({video:!1,audio:!0}),h=new A.RecordRTCPromisesHandler(m,{type:"audio"}),r.value=0,o.value=!1}catch(e){console.log("err",e),i.value=!0}};(0,s.bv)((()=>{try{const e=new Audio;e.muted=!0,e.autoplay=!0,e.addEventListener("canplaythrough",(()=>{console.log("loaded audio"),console.log(e.currentSrc),l.value=!0,(0,s.Y3)((()=>{e.play().then((()=>{e.muted=!1,e.volume=1,n.value=!0,u.value=!0,a.value=!1})).catch((e=>{console.log("play audio err",e)}))}))})),e.addEventListener("ended",(()=>{n.value=!1,e.muted=!0})),g.value=e}catch(e){i.value=!0}}));const M=async()=>{await x(),h?.startRecording(),t.value=!0,y=setInterval((()=>{r.value=r.value+1}),1e3)},C=async e=>{if(await D(500),!(u.value||f.value>10))try{const a=`${B}has_audio/${e}`;await H.Z.get(a);v.value=e,(0,s.Y3)((()=>{p.value&&g.value&&(g.value.src=p.value,g.value.load())}))}catch(a){f.value=f.value+1,await C(e),console.log("err",a)}},V=async()=>{await(h?.stopRecording()),t.value=!1,o.value=!0,a.value=!0,clearInterval(y),console.log("recorder",h);const e=await(h?.getBlob());if(e){u.value=!1;const a=new FormData;a.append("audio",e,"testing.mp4"),a.append("type",e.type),a.append("require_audio",!0),H.Z.post(`${B}call_with_audio`,a,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{C(e.data.id)})).catch((e=>{console.log("err",e)}))}},j=async()=>{g.value&&g.value.play()};return(e,r)=>((0,s.wg)(),(0,s.iD)("div",O,[i.value?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",T,[U,(0,s._)("i",{class:"start-recording-button fa fa-microphone","aria-hidden":"true",ref:"microphoneButton",onClick:M},null,512),t.value||o.value?((0,s.wg)(),(0,s.iD)("div",L,[(0,s._)("i",{onClick:k,class:"stop-recording-button fa fa-times-circle-o",style:{color:"red"}}),(0,s._)("div",q,[t.value?((0,s.wg)(),(0,s.iD)("i",F)):(0,s.kq)("",!0),(0,s._)("p",Z,(0,b.zw)(c.value),1)],512),o.value?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("i",{key:0,onClick:V,class:"stop-recording-button fa fa-stop-circle-o","aria-hidden":"true"})),l.value?((0,s.wg)(),(0,s.iD)("i",{key:1,onClick:j,class:"stop-recording-button fa fa-play-circle-o","aria-hidden":"true"})):(0,s.kq)("",!0)],512)):(0,s.kq)("",!0),a.value?((0,s.wg)(),(0,s.iD)("div",S,W)):(0,s.kq)("",!0),(0,s._)("div",X,[n.value?((0,s.wg)(),(0,s.iD)("p",J,[(0,s.Uk)("Audio is playing"),I,P,R])):(0,s.kq)("",!0)],512)])),i.value?((0,s.wg)(),(0,s.iD)("div",Y,E,512)):(0,s.kq)("",!0)]))}});const N=K;var G=N;const Q={class:"my-message message"},$={class:"message-container"},ee=["innerHTML"],ae={key:0,class:"image-container"},ne=["src"];var te=(0,s.aZ)({__name:"MyMessage",props:{message:{}},setup(e){const a=e,n=(0,d.iH)(null),t=()=>{const e=/`````\nimage_url: (.*)\n`````/g,t=e.exec(a.message.content);t&&(n.value=t[1])};(0,s.bv)((()=>{t()}));const o=(0,s.Fl)((()=>a.message.content.replace(/\n`````\nimage_url: (.*)\n`````/g,"")));return(e,a)=>((0,s.wg)(),(0,s.iD)("div",Q,[(0,s._)("div",$,[(0,s._)("div",{class:"message",innerHTML:o.value},null,8,ee),n.value||e.message.urls?.length?((0,s.wg)(),(0,s.iD)("div",ae,[(0,s._)("img",{src:n.value,alt:"image",style:{"max-width":"100%","max-height":"100%"}},null,8,ne)])):(0,s.kq)("",!0)])]))}});const se=(0,l.Z)(te,[["__scopeId","data-v-f685646e"]]);var oe=se,le=n(4478),ie=n.n(le);const re={class:"assistant-message message"},ue=["innerHTML"];var ce=(0,s.aZ)({__name:"AssistantMessage",props:{message:{}},setup(e){const a=e,n=new(ie().Converter);n.setOption("tables",!0),n.setOption("ghCodeBlocks",!0);const t=(0,s.Fl)((()=>n.makeHtml(a.message.content)));return(e,a)=>((0,s.wg)(),(0,s.iD)("div",re,[(0,s._)("div",{class:"message-container",innerHTML:t.value},null,8,ue)]))}});const de=ce;var ve=de;const pe=e=>((0,s.dD)("data-v-dcb6c0f8"),e=e(),(0,s.Cn)(),e),ge={class:"message-input"},fe={key:0,class:"file-preview"},me=["src"],ye={key:1},we=pe((()=>(0,s._)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJcAAACUCAMAAACp1UvlAAAASFBMVEXS0tLy8vL///+AgID29vba2trn5+fq6uq5ubnExMSEhITV1dV5eXn5+fl8fHzOzs6lpaWYmJiKiopzc3OxsbGenp6QkJDh4eFQLFKGAAABh0lEQVR4nO3cSXLDMAwFUVnwKNOUx/j+Nw2TvSWCCgClqvsErz64sRfq+nXW9f12ff26NusLly5cunDp+q+uQ2vGrrFr6/Tcbi1djazuJNfNEpiZa0ivywKYnUvSksUMXZJe7W/M0rVkMVOXpFvrYrauAju0wYxdkm9tp7R2lcfftJi5S9K9ZTF7V9sbc3BJ+tqrYR4uyXqYi0vyoIX5uMpibx3MyVUWe1/W6JJ8V53SzVVkOwXM0zUo3pijq3SufmOurjxUn9J3r5xqF/N1lSoXc3elsQrm7iqL1ZwywJVOFbAAl+SKU0a4ahYLcZXHPweLcUk6zpwyyDV7yijXkI6TsCiXyGNysTiXTC4W6JLHxOOPdEl6flws1DWxmJHrXOf6+efOd6/xWNfzw68kK1d3rqvb++5VHS5cuHDhwoULFy5cuHDhwoULFy5cuHDhwoULFy5cuHDhwoULFy5cuHDhwoULFy5cuHDhwoULFy5cf+jaWffh2ydzrqhw6cKlC5cuXLr6/hueekawV2U6rwAAAABJRU5ErkJggg==",alt:"Default thumbnail"},null,-1))),he={class:"input-container"},_e=["onClick"],ke=pe((()=>(0,s._)("i",{class:"fa fa-file-o"},null,-1))),xe=[ke],be=["onClick","disabled"],Ae=pe((()=>(0,s._)("i",{class:"fas fa-paper-plane"},null,-1)));var He=(0,s.aZ)({__name:"MessageInput",emits:["submit"],setup(e,{emit:a}){const n=(0,d.iH)(""),o=(0,d.iH)(null),l=a,i=(0,d.iH)(null),r=(0,d.iH)(null),u=(0,d.iH)(null),c=e=>{const a=e.target.files;if(a){const e=a[0];if(u.value=e,e.type.startsWith("image/")){const a=new FileReader;a.onload=e=>{i.value=e.target?.result},a.readAsDataURL(e)}else i.value=null,r.value=e.name}},v=()=>{o.value?.click()},p=()=>{n.value&&(l("submit",{message:n.value,file:u.value||null,fileName:r.value||null,filePreview:i.value||null}),n.value="",u.value=null,i.value=null,r.value=null)};return(e,a)=>((0,s.wg)(),(0,s.iD)("div",ge,[i.value||r.value?((0,s.wg)(),(0,s.iD)("div",fe,[i.value?((0,s.wg)(),(0,s.iD)("img",{key:0,src:i.value,alt:"File preview"},null,8,me)):((0,s.wg)(),(0,s.iD)("div",ye,[we,(0,s._)("p",null,(0,b.zw)(r.value),1)]))])):(0,s.kq)("",!0),(0,s._)("div",he,[(0,s._)("input",{type:"file",style:{display:"none"},ref_key:"fileContainer",ref:o,onChange:c},null,544),(0,s._)("button",{onClick:(0,t.iM)(v,["prevent"]),class:"select-file-button"},xe,8,_e),(0,s.wy)((0,s._)("textarea",{rows:"4",placeholder:"Type your message here...","onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e)},null,512),[[t.nr,n.value]]),(0,s._)("button",{class:"send-button",onClick:(0,t.iM)(p,["prevent"]),disabled:!n.value},[Ae,(0,s.Uk)("send ")],8,be)])]))}});const De=(0,l.Z)(He,[["__scopeId","data-v-dcb6c0f8"]]);var Me=De;const Ce="https://agent.anacreation.com",Oe={class:"messages"};var Te=(0,s.aZ)({__name:"MessageContainer",setup(e){const a=(0,d.iH)([]),n=(0,d.iH)(null),t={MyMessage:oe,AssistantMessage:ve};H.Z.get(Ce+"/messages?page=1&limit=25&session_id:1212a").then((({data:e})=>{a.value=e.map((e=>({id:e.message.id,role:e.role,content:Array.isArray(e.message.content)?e.message.content[0].text:e.message.content}))).reverse(),(0,s.Y3)((()=>C(n.value)))}));const o=e=>{const t={id:M(),role:"user",content:e.message,urls:e.filePreview?[e.filePreview]:[]},o={id:M(),role:"assistant",content:"<p style='vertical-align: middle'><i class=\"fa fa-spinner fa-spin fa-3x fa-fw\"></i>Thinking...</p>"};a.value.push(t),a.value.push(o),(0,s.Y3)((()=>C(n.value)));const l=e=>{const t=e.data;a.value.pop(),a.value.push({id:t.id,role:"assistant",content:t.message}),(0,s.Y3)((()=>C(n.value)))};if(e.file){const a=new FormData;a.append("file",e.file),a.append("content",e.message),a.append("require_audio","0"),H.Z.post(Ce+"/call_with_file",a).then(l)}else{const a={content:e.message,require_audio:!1};H.Z.post(Ce+"/call",a,{headers:{"Content-Type":"application/json"}}).then(l)}},l=e=>"user"===e?t["MyMessage"]:t["AssistantMessage"];return(e,t)=>((0,s.wg)(),(0,s.iD)("div",{class:"messages-container",ref_key:"messagesContainer",ref:n},[(0,s._)("div",Oe,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.value,(e=>((0,s.wg)(),(0,s.j4)((0,s.LL)(l(e.role)),{key:e.id,message:e},null,8,["message"])))),128))]),(0,s.Wm)(Me,{onSubmit:o})],512))}});const Ue=(0,l.Z)(Te,[["__scopeId","data-v-2b444178"]]);var Le=Ue;const qe={class:"home"},Fe={class:"main-container"};var Ze=(0,s.aZ)({__name:"MessagesView",setup(e){(0,d.iH)([]);return(e,a)=>{const n=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("div",qe,[(0,s.Wm)(n,{to:{name:"audio"}},{default:(0,s.w5)((()=>[(0,s.Uk)("Audio Mode")])),_:1}),(0,s._)("div",Fe,[(0,s.Wm)(Le)])])}}});const Se=(0,l.Z)(Ze,[["__scopeId","data-v-02d7fbec"]]);var Ve=Se;const je=[{path:"/",name:"home",component:x},{path:"/audio",name:"audio",component:G},{path:"/messages",name:"messages",component:Ve}],We=(0,c.p7)({history:(0,c.PO)("/"),routes:je});var Xe=We,Je=n(65),Ie=(0,Je.MT)({state:{},getters:{},mutations:{},actions:{},modules:{}});(0,t.ri)(u).use(Ie).use(Xe).mount("#app")}},a={};function n(t){var s=a[t];if(void 0!==s)return s.exports;var o=a[t]={exports:{}};return e[t].call(o.exports,o,o.exports,n),o.exports}n.m=e,function(){var e=[];n.O=function(a,t,s,o){if(!t){var l=1/0;for(c=0;c<e.length;c++){t=e[c][0],s=e[c][1],o=e[c][2];for(var i=!0,r=0;r<t.length;r++)(!1&o||l>=o)&&Object.keys(n.O).every((function(e){return n.O[e](t[r])}))?t.splice(r--,1):(i=!1,o<l&&(l=o));if(i){e.splice(c--,1);var u=s();void 0!==u&&(a=u)}}return a}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[t,s,o]}}(),function(){n.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(a,{a:a}),a}}(),function(){n.d=function(e,a){for(var t in a)n.o(a,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(a){return 0===e[a]};var a=function(a,t){var s,o,l=t[0],i=t[1],r=t[2],u=0;if(l.some((function(a){return 0!==e[a]}))){for(s in i)n.o(i,s)&&(n.m[s]=i[s]);if(r)var c=r(n)}for(a&&a(t);u<l.length;u++)o=l[u],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(c)},t=self["webpackChunkvoice_recorder"]=self["webpackChunkvoice_recorder"]||[];t.forEach(a.bind(null,0)),t.push=a.bind(null,t.push.bind(t))}();var t=n.O(void 0,[998],(function(){return n(6328)}));t=n.O(t)})();
//# sourceMappingURL=app.0264d6b5.js.map